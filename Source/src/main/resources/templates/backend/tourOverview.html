<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" th:href="@{/css/sliderCSS.css}"/>
    <script type="text/javascript" th:src="@{/js/sliderScript.js}"/>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>AniTrans Tour Overview</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link href="../../static/css/bulma.css" th:href="@{/css/bulma.css}" rel="stylesheet"/>
</head>
<body class="login-page page-layout">
<section class="hero is-link">
    <div class="hero-body">
        <div class="container is-fluid">
            <div class="columns">
                <div class="column is-one-quarter" style="margin-top: auto;">
                    <p class="title">
                        Anitrans
                    </p>
                    <p class="subtitle">
                        Logistics System
                    </p>
                </div>
                <div class="column is-half">
                    <div class="ism-slider " data-play_type="loop" id="my-slider">
                        <ol>
                            <li>
                                <img th:src="@{/images/goat.jpg}" height="531"
                                     width="945"/></li>
                            <li><img th:src="@{/images/cow.jpg}"/>
                            </li>
                            <li><img th:src="@{/images/panda.jpg}" height="479" width="640"/>
                            </li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="hero-foot">
        <div class="container is-fluid">
            <nav class="tabs is-boxed">
                <ul>
                    <li class="is-active">
                        <a>Tour Overview</a>
                    </li>
                    <li>
                        <a href="deliveries">New Tour</a>
                    </li>
                    <li>
                        <a href="drivers">Drivers</a>
                    </li>
                </ul>
                <div class="is-right">
                    <form action="#" th:action="@{/logout}" method="post">
                        <input type="submit" class="button is-link" value="Log Out" />
                    </form>
                </div>
            </nav>
        </div>
    </div>
</section>
<div class="block">
    <div class="columns is-gapless">
        <div class="column is-one-third ">
            <div class="content">
                <div class="column">
                    <div class="columns">
                        <div class="column ">
                            Sort by:
                        </div>
                        <div class="column is-half">
                            <div class="select">
                                <select onChange="paramChangerSetter('sortBy', this.value)">
                                    <option th:selected="${sortBy == 'Date/Time'}">Date/Time</option>
                                    <option th:selected="${sortBy == 'Starting Location'}">Starting Location</option>
                                    <option th:selected="${sortBy == 'Target Location'}">Target Location</option>
                                    <option th:selected="${sortBy == 'Driver'}">Driver</option>
                                    <option th:selected="${sortBy == 'Cargo'}">Cargo</option>
                                </select>
                            </div>

                        </div>
                    </div>
                </div>

                <div th:if="${#lists.isEmpty(tours)}">
                    <div class="notification is-warning ">
                        <div class="columns is-desktop is-vcentered">
                            <div class="column is-narrow">
                                <span class="icon"><i class="fa fa-frown-o fa-3x"></i>&nbsp;</span>
                            </div>
                            <div class="column "><p>No tours available. <a href="/deliveries">Create a new tour.</a></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div th:if="${not #lists.isEmpty(tours)}" th:each="tour : ${tours}">
                    <div th:with="result=${tour.id}">
                        <div class="notification" th:classappend="${tour.id == activeTour.id} ? is-info">
                            <a th:href="'tours/delete?index=' + ${result}" class="button delete"></a>
                            <a th:attr="onClick='paramChangerSetter(\'activeIndex\', ' + ${result} + ')'">
                                <div class="columns is-gapless">
                                    <div class="column is-half">
                                        <div class="columns is-gapless">
                                            <div class="column is-narrow">
                                                <span class="icon"><i class="fa fa-calendar"></i>&nbsp;</span>
                                            </div>
                                            <div class="column "><u th:text="${#temporals.format(tour.deliveryStartDate, 'dd.MM.yyyy')}"></u></div>
                                        </div>
                                    </div>
                                    <div class="column is-half">
                                        <div class="columns is-gapless">
                                            <div class="column is-narrow">
                                                <span class="icon"><i class="fa fa-clock-o"></i>&nbsp;</span>
                                            </div>
                                            <div class="column"><u th:text="${tour.estimatedTime}"></u></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns is-gapless">
                                    <div class="column is-half">
                                        <div class="columns is-gapless">
                                            <div class="column is-narrow">
                                                <span class="icon"><i class="fa fa-map-pin"></i>&nbsp;</span>
                                            </div>
                                            <div class="column"><u th:text="${tour.startAddress.city}"></u></div>
                                        </div>
                                    </div>
                                    <div class="column is-half">
                                        <div class="columns is-gapless">
                                            <div class="column is-narrow">
                                                <span class="icon"><i class="fa fa-flag-checkered"></i>&nbsp;</span>
                                            </div>
                                            <div class="column"><u th:text="${tour.destinationAddress.city}"></u></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="columns is-gapless">
                                    <div class="column is-half">
                                        <div class="columns is-gapless">
                                            <div class="column is-narrow">
                                                <span class="icon"><i class="fa fa-user"></i>&nbsp;</span>
                                            </div>
                                            <div class="column"><u th:text="${tour.driver}"></u></div>
                                        </div>
                                    </div>
                                    <div class="column is-half">
                                        <div class="columns is-gapless">
                                            <div class="column is-narrow">
                                                Cargo:&nbsp;
                                            </div>
                                            <div class="column"><u th:text="${tour.cargo}"></u></div>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div th:if="${not #lists.isEmpty(tours)}" class="column">
            <div class="block">
                <div class="box">
                    <form action="#" th:action="@{/tours/update}" th:object="${activeTour}" method="post">
                        <input type="hidden" th:field="*{id}" />
                        <input type="hidden" th:field="*{estimatedTime}" />
                        <input type="hidden" th:field="*{timeFrame}" />
                        <div class="columns">
                            <div class="column is-2">Cargo:</div>
                            <div class="column is-4">
                                <div class="field">
                                    <input class="input" type="text" th:field="*{cargo}"/>
                                </div>
                                <article class="message is-warning" th:if="${#fields.hasErrors('cargo')}">
                                    <div class="message-body" th:errors="*{cargo}">
                                        Error in numberOfAnimals
                                    </div>
                                </article>
                            </div>
                            <div class="column is-2">Number:</div>
                            <div class="column is-4 ">
                                <div class="field">
                                    <input class="input" type="text" th:field="*{numberOfAnimals}"/>
                                </div>
                                <article class="message is-warning" th:if="${#fields.hasErrors('numberOfAnimals')}">
                                    <div class="message-body" th:errors="*{numberOfAnimals}">
                                        Error in numberOfAnimals
                                    </div>
                                </article>
                            </div>
                        </div>
                        <div class="columns  is-multiline">
                            <div class="column is-2">Start:</div>
                            <div class="column is-4">
                                <div class="field">
                                    <input class="input" type="text" th:field="*{startAddress.name}"/>
                                </div>
                                <article class="message is-warning" th:if="${#fields.hasErrors('startAddress.name')}">
                                    <div class="message-body" th:errors="*{startAddress.name}">
                                        Error in numberOfAnimals
                                    </div>
                                </article>
                            </div>
                            <div class="column is-2 is-center">Destination:</div>
                            <div class="column is-4 ">
                                <div class="field">
                                    <input class="input" type="text" th:field="*{destinationAddress.name}"/>
                                </div>
                                <article class="message is-warning" th:if="${#fields.hasErrors('destinationAddress.name')}">
                                    <div class="message-body" th:errors="*{destinationAddress.name}">
                                        Error in numberOfAnimals
                                    </div>
                                </article>
                            </div>
                            <div class="column is-2"></div>
                            <div class="column is-4">
                                <div class="field">
                                    <input class="input" type="text" th:field="*{startAddress.surname}"/>
                                </div>
                                <article class="message is-warning" th:if="${#fields.hasErrors('startAddress.surname')}">
                                    <div class="message-body" th:errors="*{startAddress.surname}">
                                        Error in numberOfAnimals
                                    </div>
                                </article>
                            </div>
                            <div class="column is-2"></div>
                            <div class="column is-4">
                                <div class="field">
                                    <input class="input" type="text" th:field="*{destinationAddress.surname}"/>
                                </div>
                                <article class="message is-warning" th:if="${#fields.hasErrors('destinationAddress.surname')}">
                                    <div class="message-body" th:errors="*{destinationAddress.surname}">
                                        Error in numberOfAnimals
                                    </div>
                                </article>
                            </div>
                            <div class="column is-2"></div>
                            <div class="column is-3">
                                <div class="field">
                                    <input class="input" type="text" th:field="*{startAddress.street}"/>
                                </div>
                                <article class="message is-warning" th:if="${#fields.hasErrors('startAddress.street')}">
                                    <div class="message-body" th:errors="*{startAddress.street}">
                                        Error in numberOfAnimals
                                    </div>
                                </article>
                            </div>
                            <div class="column is-1">
                                <div class="field">
                                    <input class="input" type="text" th:field="*{startAddress.streetNumber}"/>
                                </div>
                                <article class="message is-warning" th:if="${#fields.hasErrors('startAddress.streetNumber')}">
                                    <div class="message-body" th:errors="*{startAddress.streetNumber}">
                                        Error in numberOfAnimals
                                    </div>
                                </article>
                            </div>
                            <div class="column is-2"></div>
                            <div class="column is-3">
                                <div class="field">
                                    <input class="input" type="text" th:field="*{destinationAddress.street}"/>
                                </div>
                                <article class="message is-warning" th:if="${#fields.hasErrors('destinationAddress.street')}">
                                    <div class="message-body" th:errors="*{destinationAddress.street}">
                                        Error in numberOfAnimals
                                    </div>
                                </article>
                            </div>
                            <div class="column is-1">
                                <div class="field">
                                    <input class="input" type="text" th:field="*{destinationAddress.streetNumber}"/>
                                </div>
                                <article class="message is-warning" th:if="${#fields.hasErrors('destinationAddress.streetNumber')}">
                                    <div class="message-body" th:errors="*{destinationAddress.streetNumber}">
                                        Error in numberOfAnimals
                                    </div>
                                </article>
                            </div>
                            <div class="column is-2"></div>
                            <div class="column is-2">
                                <div class="field">
                                    <input class="input" type="text" th:field="*{startAddress.zip}"/>
                                </div>
                                <article class="message is-warning" th:if="${#fields.hasErrors('startAddress.zip')}">
                                    <div class="message-body" th:errors="*{startAddress.zip}">
                                        Error in numberOfAnimals
                                    </div>
                                </article>
                            </div>
                            <div class="column is-2">
                                <div class="field">
                                    <input class="input" type="text" th:field="*{startAddress.city}"/>
                                </div>
                                <article class="message is-warning" th:if="${#fields.hasErrors('startAddress.city')}">
                                    <div class="message-body" th:errors="*{startAddress.city}">
                                        Error in numberOfAnimals
                                    </div>
                                </article>
                            </div>
                            <div class="column is-2"></div>
                            <div class="column is-2">
                                <div class="field">
                                    <input class="input" type="text" th:field="*{destinationAddress.zip}"/>
                                </div>
                                <article class="message is-warning" th:if="${#fields.hasErrors('destinationAddress.zip')}">
                                    <div class="message-body" th:errors="*{destinationAddress.zip}">
                                        Error in numberOfAnimals
                                    </div>
                                </article>
                            </div>
                            <div class="column is-2">
                                <div class="field">
                                    <input class="input" type="text" th:field="*{destinationAddress.city}"/>
                                </div>
                                <article class="message is-warning" th:if="${#fields.hasErrors('destinationAddress.city')}">
                                    <div class="message-body" th:errors="*{destinationAddress.city}">
                                        Error in numberOfAnimals
                                    </div>
                                </article>
                            </div>

                        </div>
                        <div class="columns">
                            <div class="column is-2">Date:</div>
                            <div class="column is-4">
                                <div class="field">
                                    <input class="input" type="date" th:value="${#temporals.format(activeTour.deliveryStartDate, 'uuuu-MM-dd')}" th:field="*{deliveryStartDate}"/>
                                </div>
                                <article class="message is-warning" th:if="${#fields.hasErrors('deliveryStartDate')}">
                                    <div class="message-body" th:errors="*{deliveryStartDate}">
                                        Error in numberOfAnimals
                                    </div>
                                </article>
                            </div>
                            <div class="column is-2">Time:</div>
                            <div class="column is-4">
                                <div class="field">
                                    <input class="input" type="time" th:value="${#temporals.format(activeTour.deliveryStartTime, 'HH:mm')}" th:field="*{deliveryStartTime}"/>
                                </div>
                                <article class="message is-warning" th:if="${#fields.hasErrors('deliveryStartTime')}">
                                    <div class="message-body" th:errors="*{deliveryStartTime}">
                                        Error in numberOfAnimals
                                    </div>
                                </article>
                            </div>
                        </div>
                        <div class="columns">
                            <div class="column is-2">Driver:</div>
                            <div class="column">
                                <div class="select">
                                    <select th:field="*{driver}">
                                        <option th:if="${not #lists.isEmpty(drivers)}" th:each="driver : ${drivers}" th:value="${driver.username}" th:text="${driver.username}"></option>
                                    </select>
                                </div>
                            </div>
                        </div>


                        <div class="columns">
                            <div class="column is-2">Comment:</div>
                            <div class="column">
                                <p class="control">
                                    <textarea class="textarea" type="text" th:field="*{comment}"></textarea>
                                </p>
                            </div>
                        </div>
                        <div class="columns">
                            <div class="column is-2 is-offset-10"><button type="submit" class="button is-info is-pulled-right">Save</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $(".delete").click(function () {
            $(this).parent(".notification").hide(300);
        });
    });
    

    	function paramChangerSetter(paramName, newValueForParam) {
        	var newHref = window.location.href;
        	var regularExpression = new RegExp(paramName + "=[a-zA-Z1-9/ (%20)]*", "g");
        	
        	if (regularExpression.test(newHref)) {							//update param
        		newHref = newHref.replace(regularExpression, paramName + "=" + newValueForParam);
        	} else {														//set param
        		if (newHref.indexOf("?") == -1) {
        			newHref = newHref + "?" + paramName + "=" + newValueForParam;
        		} else {
        		    //NOTE: The comments below are important for the Html-parser. Don't remove them
        			newHref = newHref + /*<![CDATA[*/"&"/*]]>*/ + paramName + "=" + newValueForParam;
        		}
        		
        	}
        	window.location.href=newHref + "";
        }
    
    
</script>
</body>
</html>